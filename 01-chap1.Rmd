<!--
This is for including Chapter 1.  Notice that it's also good practice to name your chunk.  This will help you debug potential issues as you knit.  The chunk above is called intro and the one below is called chapter1.  Feel free to change the name of the Rmd file as you wish, but don't forget to change it here from chap1.Rmd.
-->

<!--
The {#rmd-basics} text after the chapter declaration will allow us to link throughout the document back to the beginning of Chapter 1.  These labels will automatically be generated (if not specified) by changing the spaces to hyphens and capital letters to lowercase.  Look for the reference to this label at the beginning of Chapter 2.
-->

# Introduction {#intro}

Mortgage bonds have a long history in Denmark, originating from 1797 where a fire in Copenhagen destroyed most of the city in 1795, this event initiated the first mortgage bank [@jensen2013rentesregning]. 

The general idea on how the mortgage system in Denmark has since only seen minor changes thus a source of high stability. 

The idea being the system that instead of having a one-to-one relationship between the borrower mortgage loan and the investors mortgage bond. 

The Danish mortgage system is structured such that borrowers have their loans pooled, to which bonds is issue.  

When an investor buys a bond issued from the pool, this is equivalent to buying a share of the pooled loans, in which the investor is entitled to receive interest payments and repayment proportional to the invested amount.  

What makes the Danish mortgage system distinguishable is the balance principle. This principle ensures an almost perfect match between the interest and repayments paid and received by the borrowers and investors respectively.  

Figure \@ref(fig:bondCashFlow) illustrates the cash flows that occurs between the borrow, the mortgage bank and the investor. When a loan is granted to a borrower, the mortgage bank issues a bond in the primary market accordingly. The investor then buys the bonds and the process from the trades go to the borrower thus giving the borrower liquidity to purchase the dwelling on which the loan is based.  

The borrower will pay interest, repayments and fees known as the so-called "bidragssats" to the mortgage bank, who facilitate that the interest and repayments are passed through to the investor and thereby keeping the fees to cover their costs of issuing the bonds and the adherent risk associated with the issuance of bonds, since the issuing mortgage bank takes on the risk opposed to the borrower.  

The credit risk of the borrower is towards the mortgage bank, and since the housing is used at collateral in the agreement the credit risk is lowered in the viewpoint of the mortgage bank.  

The default risk held by the investor is even more reduced since the mortgage bank has go into default before the investor will be exposed to a credit event. In a potential credit event of the mortgage bank, the investors will have the right to the cover pool, which is separate legal structure ensuring that the bond investors in a credit event does not have share to their claim towards the mortgage bank along with other creditors.  

The cover pool will consist of collateral in terms of the claims against the borrows as well as additional securities posed by the mortgage bank to protect the investor from losses. These securities constitute what is known as overcollateralization and should be of very high credit quality.  

Since modelling will be performed from the investors point of view, and the default risk held by the investor has been brought to a minimum, the paper will not include default risk in our model.



```{r bondCashFlow, echo = FALSE, fig.align='center', out.width="100%", fig.cap="Simplified illustration of the relationships and payment streams between the homeowner, the mortgage bank and the investor in the Danish mortgage system."}
knitr::include_graphics("figure/bond_cash_flow_illustration_23012022.png")
```


```{r BondMarketSize, echo = FALSE, warning = FALSE, message=FALSE, error=FALSE}
library(statsDK); library(dplyr); library(stringr); library(lubridate); library(ggplot2); library(tidyr); library(zoo)
real_marked <- sdk_retrieve_data("DNVPDKR2", DATAT = "B1", VALUTA = "DKK", TYPREAL ="A0", LØBETID2="A0", KUPON2="A0", UDSTED="A0", INVSEKTOR="A0", DAEKOBL="A0")
real_marked$TID <- ymd(paste0(as.Date(as.yearmon(as.character(real_marked[["TID"]]), "%YM%m"))))
market_size <- real_marked[ which(real_marked$TID==max(real_marked$TID) & real_marked$LØBETID3 == "All original maturities"), ][[11]]

```

To understand why the Danish mortgage system is of interest is due to impact on
the Danish economy and the significant size of the market, being the largest covered
bond market in Europe [@ECBC2021], where in `r str_to_sentence(format(zoo::as.yearmon(real_marked[ which(real_marked$TID==max(real_marked$TID)), ][[10]][[1]]), "%B %Y"))` the Danish mortgage market amounted to DKK `r format(round((market_size/10000)), scientific=F, nsmall=0, big.mark=",")` billions.  

According to the Danish central bank, Nationalization, the foreign ownership of Danish Mortgage bonds totalled DKK 802 billions as of Dec 2021 or equivalent to 24% of the total amount outstanding in the Danish mortgage system.  

  
  
THe market for Danish mortgage bonds consits mainly of fixed coupon callable bonds, adjustable rate mortgage bonds and capped floating rate bonds.

The focus of this thesis will be on the fixed income coupon callable bonds due it being the most complex of the aforementioned.,


In order to understand the different aspects of a callable bond, we will first have to introduce the term structure theory and build a framework for descrying the behaviour of the yield curve. This in done in \@ref(theory)



# The Danish Mortgage Market

Being one of the oldest and most stable bond markets in the world, the Danish Bond market has it's root all the way back to 1797 where the first mortgage bank Kreditkassen for Husejere i Kjøbenhavn was established to help rebuild Copenhagen after the devastating fire of 1795 where a quarter of the city was lost to the fire.  

The objective of stabilibty can also be seen in the resistance of the Danish Mortgage Market to economic crises, as the Danish economy has gone through several crises the past 50 years.

* The two oil crises of the 1970's
* The 1986 austerity package and the 1987 tax reform
* The Dot-com bubble in 2000
* The financial crises

Arguable each crises has had an effect on the mortgage system differently and have even caused substitutional losses to the mortgage banks. However the losses have never affected the investors, as not one Danish Mortgage bondholder has lost the investment or even part of it. Moreover, the market stayed active and liquid under the financial crisis as evidenced by [@dick2012corporate; @Gundersen2011], where both find that the Danish Mortgage Bonds were as liqui as the Danish Government bonds during years from 2008 to 2009.

## Types of mortgage bonds
The Danish mortgage market mainly consists of the following types of mortgage bonds 

* ARMs - Adjustable Rate Mortgage Securities. which are subject to refinancing until the longer-term underlying loan has matured. The maturities match the fixed-rate period of the underlying loan, and are mainly 1 to 5 yers and the bond type is bullet

* Floating-rate note - Variable-rate annuities with redemptions matching the underlying loans. The maturites mainly range from 1 to 5 years. 

* Capped floater - Variable-rate annuities with redemptions not matching the underlying loans. The maturites are mainly from 5 to 30 years

* Callable bonds - Fixed rate callable annuities, where payments and redemptions match the underlying loan. The maturities are mainly 15, 20 or 30 years.

All 4 types of mortgage bonds have underlying loans where maturires of up to 30 years are available. Furthermore, most loans can be offered with an interest only(IO) period up to 30 years. If the IO option is chosen, the loan must be repaid as an bullet bond at maturity, otherwise if a IO period of 10 years is chosen, the loan must be repaid as an annuity profile for the remaining lifetime of the loan i.e. 20 years. In recent years the amount of loans with interest only option has declined and as of December 2021, interest only loans accounts for 43.5 %^[Nationalbanken Statistics - DNRUDDKI] of the loans to Danish house-holds.  

## The Danish mortgage model 
The Danish mortgage model is based upon a stable and transparent system, with several advantages and unique features. Since mortgage banks does not function as commercial banks, and only able to fund loans through the sale of bonds which limits the risk of the mortgage banks Hence, the mortgage bank protects the investor from borrower defaulting. The mortgage bank secures the issued bond by using the cover pool which consist of collateral in terms of the claims against the borrows as well as additional securities posed by the mortgage bank to protect the investor from losses. These securities constitute what is known as overcollateralization and should be of very high credit quality.  


## Match funding principle
The match-funding principle entails that for every loan made by the mortgage bank, a new bond is issued with matching cash-flow properties. This eliminates mismatch in cash-flows and refinancing risk for the mortgage bank, which also secures payments to the bondholder. In the Danish mortgage system the mortgage bank functions as an intermediary between the investor and the borrower. Mortgage banks funds loans on a current basis, meaning that hte bond must be sold before the loan can be given. This also entails that the market price of the bond determines the loan rate. THe loan is therefore equal to the investment, which passes through the mortgage bank. Repayment and interest from the borrower to investor also passed through them mortgage bank, however the mortgage bank changes the borrower a margin though the lifetime of the loan, which is a percentage of the debt outstanding.  

Since mortgage banks is only an intermediary it is not affected by changes in the floating rate, as it passes repayments and interest through to the investor. The drawback for the mortgage bank is that it endures the credit risk in the event of a default of the borrower, as it still has to make repayment and interest to the bond holder. This however protects the investor as the credit risk is removed, but is also a great incentive for the mortgage bank to put an emphasis on the due diligence process when issuing loans and adds to the stability of the system. Part of the due diligence is not only the valuing the property when making a credit assessment of a potential borrower, but also assessing the borrower's current economic situation including income and wealth based on legislation that dictates eligibility for granting and funding loans.

## Delivery and prepayment
A central unique feature of the Danish mortgage model is the delivery option which means that the borrower always ahs the possibility of buying the underlying bond in the market, and delivering it back to the mortgage bank, which then cancels the loan. This is unique way for the borrower to reduce the notional amount of the loan if interest rate rises, and the related bond price falls. It is also a hedging effect on the expected drop in house prices that follows increasing interest rates as the two effect offset each other. This has no effect on the investor in terms of payments made from the investors to the bondholders.  

Callables bonds also have a prepayment option( embedded call-option). The prepayment option gives the borrower the opportunity to repay the loan at pari (100) at every quarter throughout the lifetime of the loan.  

Capped floaters have a similar prepayment option, however the prices depends on the contract is typically 105. This is favorable when the current available coupon rate is below the coupon rate on the mortgage.  

The prepayment on Danish callables and capped floaters are more difficult to price than corresponding bond without the prepayment option and come with an additional option and come with an additional prepayment risk for the investor, this is however compensated with a higher interest rate.  

The prepayment risk arises from the option to prepay the loan at pari, which exposes the investor to the risk of not being able to reinvest at the same conditions. The rational scenarios for prepayment are depicted in figure \@ref(fig:prepayment)

```{r prepayment, echo = FALSE, fig.align='center', out.width="100%", fig.cap="Pricing curve of Callabalbe Bonds and Non-callable bonds."}
knitr::include_graphics("figure/prepay.png")
```

When prices are close to par the price of the callable bond is lower than the price of a non-callable bond, i.e. government bond, as the chance of prepayment increases. However the borrowers are not always rational, which can create opportunities for the active investor, but is also a source of risk for a buy-and-hold strategy.

## Prepayment Risk
The borrowers have the possibility to repay (part of) the notional before maturity, these kinds of anticipated and unexpected payments are called prepayment. this make the duration of the mortgage bond stochastic, which creates complication in refinancing for the investor. The investor is interested in prepayment rate on a security level, rather than a single borrower.  
A prepayment option is an option which "reflect the difference between the value of the outstanding loan repayments at the interest rate at the time of the prepayment for the remaining term of the loan minus the amount of the loan then outstanding (which is the value of the outstanding loan repayments at the original loan interest rate) [@sherris1994pricing].  
if the interest rate goes down then the option is in the money, controversially if the interest rate goes up the optionality is out of the money. The exercise price of this call is equal to the loan outstanding. Rationally, the call should be exercised only if the difference mentioned above is positive since, otherwise, the option is worth more if you don't exercise it. Meaning thta it is more convenient to put money in a saving account rather than prepay the mortgage. However borrowers does not always act economically rational though, from now on we will use the the term non-ration to identify something that differs from the economically rational behaviour explained earlier.

An American call option on an amortizing reducing term swap could be a good instrument to hedge the prepayment option, but the ideal hedge instrument may not exist. For instance, assuming that the duration on the financing and of the loan are perfectly matched, suppose a 20 years mortgage loan at 4% is financed with a 20 years bond paying 3.5 %. If the interest rate goes down to 3%, the borrower will have to refinance at the new rate prepaying the old mortgage and opening a new one at the lower interest rate. However, the bank will still have the obligation of paying 3.5 % interest on the bond used to finance the first loan. Moreover, since the price of the perfect hedge instrument is equal to the cost of the prepayment option., if this instrument existed, it could be use to price the option [@sherris1994pricing].  


The possibility to prepay exposes the bank to prepayment risk, which can be divided in two classes [@consalvi2010measuring]

* Interest rate risk - This arises because fixed rate mortgage are hedged against interest rate change using Interest Rate Swaps (IRS). The bank receives the floating rate and pays the fixed one, this means that a prepayment may expose the bank to the possibility of paying a fixed rate on the derivative which is higher than the one obatined on the new loans.

* Liquidity risk - Arises from the fact that the liquidity profile of the bank is strongly influence by the maturity profile of the mortgage conditional to prepayments. An incorrect estimation of this quantity leads to the risk of under or over funding and of higher long-term liquidity costs.

Since prepayment are substation risk for the investor, is is fundamental to be able to predict the conditional prepayment rate (CPR), which is the proportion of the pricing of a pool of loans assumed to prepay in each period, in order to better forecast future cash flows.  
When modelling mortgage prepayment, we cannot just use the rational assumption as mentioned earlier to evaluate contracts (e.g. prepay only when the interest rate goes down), but we have to take into account the behaviour aspect as well, and hence we need to have a behavioural approach. In such a model we take into account factors usually estimated through statical analysis, in order to explain effect that otherwise could not have been explained. These kinds of techniques are called exogenous models, in opposition to optional prepayment models that see prepayment just as a consequence of rational behaviour e.g prepayment is always exercised at an optimal time by the borrower.  
For these reason, rather than using a rational prepayment model for which the prepayment rate depends on just the rate evolution, an empirical model which is capable of taking into account other factors is chosen. This CPR is a function of some variable like the refinance incentive, the seasoning, the age of the loan, etc,

## Incentives to prepay

