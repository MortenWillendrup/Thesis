<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A The First Appendix | Pricing Danish Mortgage Bonds using Machine learning for estimation</title>
  <meta name="description" content="A The First Appendix | Pricing Danish Mortgage Bonds using Machine learning for estimation" />
  <meta name="generator" content="bookdown 0.24.4 and GitBook 2.6.7" />

  <meta property="og:title" content="A The First Appendix | Pricing Danish Mortgage Bonds using Machine learning for estimation" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A The First Appendix | Pricing Danish Mortgage Bonds using Machine learning for estimation" />
  
  
  

<meta name="author" content="Morten SÃ¸by Willendrup" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="conclusion.html"/>
<link rel="next" href="roadmap.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preliminary Content</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dedication"><i class="fa fa-check"></i>Dedication</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="abstract-1.html"><a href="abstract-1.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="1-intro.html"><a href="1-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html"><i class="fa fa-check"></i><b>2</b> The Danish Mortgage Market</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#types-of-mortgage-bonds"><i class="fa fa-check"></i><b>2.1</b> Types of mortgage bonds</a></li>
<li class="chapter" data-level="2.2" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#the-danish-mortgage-model"><i class="fa fa-check"></i><b>2.2</b> The Danish mortgage model</a></li>
<li class="chapter" data-level="2.3" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#balance"><i class="fa fa-check"></i><b>2.3</b> Balance principle</a></li>
<li class="chapter" data-level="2.4" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#delivery-and-prepayment"><i class="fa fa-check"></i><b>2.4</b> Delivery and prepayment</a></li>
<li class="chapter" data-level="2.5" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#callable-annuity-bonds"><i class="fa fa-check"></i><b>2.5</b> Callable annuity bonds</a></li>
<li class="chapter" data-level="2.6" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#prepayment"><i class="fa fa-check"></i><b>2.6</b> Prepayment</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#calculating-prepayment-gains"><i class="fa fa-check"></i><b>2.6.1</b> Calculating prepayment gains</a></li>
<li class="chapter" data-level="2.6.2" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#different-types-of-remortgaging-strategies"><i class="fa fa-check"></i><b>2.6.2</b> Different types of remortgaging strategies</a></li>
<li class="chapter" data-level="2.6.3" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#remortgage-gain-depends-on-several-factors"><i class="fa fa-check"></i><b>2.6.3</b> Remortgage gain depends on several factors</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#estimating-prepayments"><i class="fa fa-check"></i><b>2.7</b> Estimating prepayments</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="2-the-danish-mortgage-market.html"><a href="2-the-danish-mortgage-market.html#data-for-estimating-prepayments"><i class="fa fa-check"></i><b>2.7.1</b> Data for estimating prepayments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html"><i class="fa fa-check"></i><b>3</b> Term strucutre</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html#the-short-rate"><i class="fa fa-check"></i><b>3.1</b> The Short Rate</a></li>
<li class="chapter" data-level="3.2" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html#zero-coupon-bonds"><i class="fa fa-check"></i><b>3.2</b> Zero Coupon Bonds</a></li>
<li class="chapter" data-level="3.3" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html#interest-rate-swaps"><i class="fa fa-check"></i><b>3.3</b> Interest Rate Swaps</a></li>
<li class="chapter" data-level="3.4" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html#zero-rates-forward-rates-and-curve-fitting"><i class="fa fa-check"></i><b>3.4</b> Zero Rates, Forward Rates and Curve Fitting</a></li>
<li class="chapter" data-level="3.5" data-path="3-term-strucutre.html"><a href="3-term-strucutre.html#caps-floors"><i class="fa fa-check"></i><b>3.5</b> Caps &amp; Floors</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html"><i class="fa fa-check"></i><b>4</b> Callable Mortgage Bonds</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#callability"><i class="fa fa-check"></i><b>4.1</b> Callability</a></li>
<li class="chapter" data-level="4.2" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#prepayment-1"><i class="fa fa-check"></i><b>4.2</b> Prepayment</a></li>
<li class="chapter" data-level="4.3" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#the-mortgage-pde"><i class="fa fa-check"></i><b>4.3</b> The Mortgage PDE</a></li>
<li class="chapter" data-level="4.4" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#pricing-by-finite-differences"><i class="fa fa-check"></i><b>4.4</b> Pricing by Finite Differences</a></li>
<li class="chapter" data-level="4.5" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#the-extended-vasicek-model"><i class="fa fa-check"></i><b>4.5</b> The Extended Vasicek Model</a></li>
<li class="chapter" data-level="4.6" data-path="4-callable-mortgage-bonds.html"><a href="4-callable-mortgage-bonds.html#the-delivery-option"><i class="fa fa-check"></i><b>4.6</b> The Delivery Option</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-estimating-prepayments-1.html"><a href="5-estimating-prepayments-1.html"><i class="fa fa-check"></i><b>5</b> Estimating Prepayments</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-estimating-prepayments-1.html"><a href="5-estimating-prepayments-1.html#the-danish-prepayment-data"><i class="fa fa-check"></i><b>5.1</b> The Danish Prepayment Data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-theory.html"><a href="6-theory.html"><i class="fa fa-check"></i><b>6</b> Theory</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-theory.html"><a href="6-theory.html#term-strucutre-1"><i class="fa fa-check"></i><b>6.1</b> Term Strucutre</a></li>
<li class="chapter" data-level="6.2" data-path="6-theory.html"><a href="6-theory.html#callable-mortgage-bonds-1"><i class="fa fa-check"></i><b>6.2</b> Callable Mortgage Bonds</a></li>
<li class="chapter" data-level="6.3" data-path="6-theory.html"><a href="6-theory.html#estimating-prepayments-application-of-machine-learning"><i class="fa fa-check"></i><b>6.3</b> Estimating prepayments, application of machine learning</a></li>
<li class="chapter" data-level="6.4" data-path="6-theory.html"><a href="6-theory.html#ke"><i class="fa fa-check"></i><b>6.4</b> Ke</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-data.html"><a href="7-data.html"><i class="fa fa-check"></i><b>7</b> Data</a></li>
<li class="chapter" data-level="8" data-path="8-estimation.html"><a href="8-estimation.html"><i class="fa fa-check"></i><b>8</b> Estimation</a></li>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html"><i class="fa fa-check"></i><b>A</b> The First Appendix</a>
<ul>
<li class="chapter" data-level="A.1" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html#vasicek-odes"><i class="fa fa-check"></i><b>A.1</b> Vasicek ODEs</a></li>
<li class="chapter" data-level="A.2" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html#fitting-the-initial-term-structure"><i class="fa fa-check"></i><b>A.2</b> Fitting the Initial Term structure</a></li>
<li class="chapter" data-level="A.3" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html#the-variance-of-the-short-rate"><i class="fa fa-check"></i><b>A.3</b> The Variance of the Short Rate</a></li>
<li class="chapter" data-level="A.4" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html#the-expected-value-under-mathbbqs"><i class="fa fa-check"></i><b>A.4</b> The Expected Value Under <span class="math inline">\(\mathbb{Q}\)</span>^S</a></li>
<li class="chapter" data-level="A.5" data-path="A-the-first-appendix.html"><a href="A-the-first-appendix.html#vasicek-mle"><i class="fa fa-check"></i><b>A.5</b> Vasicek MLE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html"><i class="fa fa-check"></i>Roadmap</a>
<ul>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html#timeline"><i class="fa fa-check"></i>Timeline</a></li>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html#logbook"><i class="fa fa-check"></i>Logbook</a>
<ul>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html#theory-1"><i class="fa fa-check"></i>Theory</a></li>
<li class="chapter" data-level="" data-path="roadmap.html"><a href="roadmap.html#data-1"><i class="fa fa-check"></i>Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Pricing Danish Mortgage Bonds using Machine learning for estimation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-first-appendix" class="section level1" number="9">
<h1><span class="header-section-number">A</span> The First Appendix</h1>
<div id="vasicek-odes" class="section level2" number="9.1">
<h2><span class="header-section-number">A.1</span> Vasicek ODEs</h2>
<p>We have to find the solutions to the ODEs of equations (3.51) and (3.52). If we guess a solutions <span class="math inline">\(B(t, T)=\frac{1}{\kappa}\left(1-\mathrm{e}^{-\kappa(T-t)}\right)\)</span> and insert into equation (3.52) we see that the ODE is satisfied
<span class="math display">\[
1+\frac{\mathrm{d} B(t, T)}{\mathrm{d} t}-\kappa B(t, T)=1-\mathrm{e}^{-\kappa(T-t)}-\kappa \frac{1}{\kappa}\left(1-\mathrm{e}^{-\kappa(T-t)}\right)=0
\]</span>
The boundary condition <span class="math inline">\(B(T, T)=\frac{1}{\kappa}\left(1-\mathrm{e}^{-\kappa(T-T)}\right)=0\)</span> is also satisfied. Inserting <span class="math inline">\(B(t, T)\)</span> into the ODE (3.51) and integrating from <span class="math inline">\(t\)</span> to <span class="math inline">\(T\)</span> we get
<span class="math display">\[
A(T, T)-A(t, T)+\kappa \int_{t}^{T} \hat{\theta}(s) B(s, T) \mathrm{d} s-\frac{1}{2} \sigma^{2} \int_{t}^{T} B^{2}(s, T) \mathrm{d} s=0
\]</span>
Using that <span class="math inline">\(A(T, T)=0\)</span> and rearranging we get
<span class="math display">\[
A(t, T)=\kappa \int_{t}^{T} \hat{\theta}(s) B(s, T) \mathrm{d} s-\frac{1}{2} \sigma^{2} \int_{t}^{T} B^{2}(s, T) \mathrm{d} s
\]</span>
We now evaluate the integral over <span class="math inline">\(B^{2}(t, T)\)</span> :
<span class="math display">\[
\begin{aligned}
\int_{t}^{T} B^{2}(s, T) \mathrm{d} s &amp;=\int_{t}^{T} \frac{1}{\kappa^{2}}\left(1+\mathrm{e}^{-2 \kappa(T-s)}-2 \mathrm{e}^{-\kappa(T-s)}\right) \mathrm{d} s \\
&amp;=\frac{1}{\kappa^{2}}\left((T-t)+\frac{1}{2 \kappa}-\frac{1}{2 \kappa} \mathrm{e}^{-2 \kappa(T-t)}-\frac{2}{\kappa}+\frac{2}{\kappa} \mathrm{e}^{-\kappa(T-t)}\right) \\
&amp;=\frac{1}{\kappa^{2}}\left((T-t)-\frac{1}{2 \kappa}\left(1+\mathrm{e}^{-2 \kappa(T-t)}-2 \mathrm{e}^{-\kappa(T-t)}\right)-B(t, T)\right) \\
&amp;=\frac{1}{\kappa^{2}}\left((T-t)-\frac{\kappa}{2} B^{2}(t, T)-B(t, T)\right)
\end{aligned}
\]</span>
Inserting (A.2) in (A.1) and we find the expression for <span class="math inline">\(A(t, T)\)</span> :
<span class="math display">\[
A(t, T)=\kappa \int_{t}^{T} \hat{\theta}(s) B(s, T) \mathrm{d} s+\frac{\sigma^{2}}{4 \kappa} B^{2}(t, T)+\frac{\sigma^{2}}{2 \kappa^{2}}(B(t, T)-(T-t))
\]</span></p>
</div>
<div id="fitting-the-initial-term-structure" class="section level2" number="9.2">
<h2><span class="header-section-number">A.2</span> Fitting the Initial Term structure</h2>
<p>We want to confirm that the function for <span class="math inline">\(\hat{\theta}(t)\)</span> given in equation <span class="math inline">\((3.55)\)</span> indeed fits the initial term structure. We start out by differentiating <span class="math inline">\(A(0, t)\)</span> with the purpose of isolating <span class="math inline">\(\hat{\theta}(t):\)</span>
<span class="math display">\[
\frac{\mathrm{d} A(0, t)}{\mathrm{d} t}=\frac{\mathrm{d}}{\mathrm{d} t}\left(\kappa \int_{0}^{t} \hat{\theta}(s) B(s, t) \mathrm{d} s+\frac{\sigma^{2}}{4 \kappa} B^{2}(0, t)+\frac{\sigma^{2}}{2 \kappa^{2}}(B(0, t)-t)\right)
\]</span>
<span class="math display">\[
\begin{aligned}
&amp;=\kappa \int_{0}^{t} \hat{\theta}(s) \mathrm{e}^{-\kappa(t-s)} \mathrm{d} s+\frac{\sigma^{2}}{2 \kappa} B(0, t) \frac{\mathrm{d} B(0, t)}{\mathrm{d} t}+\frac{\sigma^{2}}{2 \kappa^{2}} \frac{\mathrm{d} B(0, t)}{\mathrm{d} t}-\frac{\sigma^{2}}{2 \kappa^{2}} \\
&amp;=\kappa \int_{0}^{t} \hat{\theta}(s) \mathrm{e}^{-\kappa(t-s)} \mathrm{d} s-\frac{\sigma^{2}}{2 \kappa^{2}}\left(\mathrm{e}^{-\kappa t}-\mathrm{e}^{-2 \kappa t}\right)-\frac{\sigma^{2}}{2 \kappa^{2}} \mathrm{e}^{-\kappa t}-\frac{\sigma^{2}}{2 \kappa^{2}} \\
&amp;=\kappa \int_{0}^{t} \hat{\theta}(s) \mathrm{e}^{-\kappa(t-s)} \mathrm{d} s-\frac{\sigma^{2}}{2} B^{2}(0, t)
\end{aligned}
\]</span>
We now find the second derivative to be
<span class="math display">\[
\begin{aligned}
\frac{\mathrm{d}^{2} A(0, t)}{\mathrm{d} t^{2}} &amp;=\kappa \hat{\theta}(t)-\kappa^{2} \int_{0}^{t} \hat{\theta}(s) \mathrm{e}^{-\kappa(t-s)} \mathrm{d} s-\sigma^{2} B(0, t) \mathrm{e}^{-\kappa t} \\
&amp;=\kappa \hat{\theta}(t)-\kappa \frac{\mathrm{d} A(0, t)}{\mathrm{d} t}-\kappa \frac{\sigma^{2}}{2} B^{2}(0, t)-\sigma^{2} B(0, t) \mathrm{e}^{-\kappa t} \\
&amp;=\kappa \hat{\theta}(t)-\kappa \frac{\mathrm{d} A(0, t)}{\mathrm{d} t}-\frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa t}\right)
\end{aligned}
\]</span>
In the above we have applied Leibnitzâs rule <span class="math inline">\({ }^{8}\)</span> stating that for a function <span class="math inline">\(f=f(x, t)\)</span>
<span class="math display">\[
\frac{\mathrm{d}}{\mathrm{d} x} \int_{u(x)}^{v(x)} f(x, t) \mathrm{d} t=f(x, v(x)) \frac{\mathrm{d} v(x)}{\mathrm{d} x}-f(x, u(x)) \frac{\mathrm{d} u(x)}{\mathrm{d} x}+\int_{u(x)}^{v(x)} \frac{\partial f(x, t)}{\partial x} \mathrm{~d} t
\]</span>
We may now isolate <span class="math inline">\(\hat{\theta}(t)\)</span> by rearranging (A.4):
<span class="math display">\[
\hat{\theta}(t)=\frac{\mathrm{d} A(0, t)}{\mathrm{d} t}+\frac{1}{\kappa} \frac{\mathrm{d}^{2} A(0, t)}{\mathrm{d} t^{2}}+\frac{\sigma^{2}}{2 \kappa^{2}}\left(1-\mathrm{e}^{-2 \kappa t}\right) .
\]</span>
Since we want to choose <span class="math inline">\(\hat{\theta}(t)\)</span> such that market prices equals model prices, we must have
<span class="math display">\[
\bar{P}_{0}^{t}=\mathrm{e}^{-A(0, t)-B(0, t) r_{0}} \Leftrightarrow A(0, t)=-\ln \bar{P}_{0}^{t}-B(0, t) r_{0}
\]</span>
Differentiating <span class="math inline">\(A(0, t)\)</span> once and twice we obtain
<span class="math display">\[
\begin{aligned}
&amp;\frac{\mathrm{d} A(0, t)}{\mathrm{d} t}=-\frac{\frac{\mathrm{d} P f}{\mathrm{dt}}}{\bar{P}_{0} t}-r_{0} \mathrm{e}^{-\kappa t}=\bar{f}(0, t)-r_{0} \mathrm{e}^{-\kappa t} \\
&amp;\frac{\mathrm{d}^{2} A(0, t)}{\mathrm{d} t^{2}}=\frac{\mathrm{d} \bar{f}(0, t)}{\mathrm{d} t}+\kappa r_{0} \mathrm{e}^{-\kappa t}
\end{aligned}
\]</span>
where we have to assume that the observed forward curve is differentiable. Inserting these derivatives in (A.5) we get
<span class="math display">\[
\hat{\theta}(t)=\bar{f}(0, t)+\frac{1}{\kappa} \frac{\mathrm{d} \bar{f}(0, t)}{\mathrm{d} t}+\frac{\sigma^{2}}{2 \kappa^{2}}\left(1-\mathrm{e}^{-2 \kappa t}\right),
\]</span></p>
<p>which is exactly equation (3.55). Inserting this in the expression for <span class="math inline">\(A(t, T)\)</span> we get
<span class="math display">\[
\begin{aligned}
A(t, T) &amp;=\int_{t}^{T} \bar{f}(0, s)\left(1-\mathrm{e}^{-\kappa(T-s)}\right) \mathrm{d} s+\frac{1}{\kappa} \int_{t}^{T} \frac{\mathrm{d} \bar{f}(0, s)}{\mathrm{d} t}\left(1-\mathrm{e}^{-\kappa(T-s)}\right) \mathrm{d} s \\
&amp;+\int_{t}^{T} \frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa s}\right) B(s, T) \mathrm{d} s+\frac{\sigma^{2}}{4 \kappa} B^{2}(t, T)+\frac{\sigma^{2}}{2 \kappa^{2}}(B(t, T)-(T-t)) \\
&amp;=-\ln \left(\frac{\bar{P}_{0}^{T}}{\bar{P}_{0}^{t}}\right)-\int_{t}^{T} \bar{f}(0, s) \mathrm{e}^{-\kappa(T-s)} \mathrm{d} s+\frac{1}{\kappa}(\bar{f}(0, T)-\bar{f}(0, t)) \\
&amp;-\frac{1}{\kappa} \int_{t}^{T} \frac{\mathrm{d} \bar{f}(0, s)}{\mathrm{d} t} \mathrm{e}^{-\kappa(T-s)} \mathrm{d} s+\int_{t}^{T} \frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa s}\right) B(s, T) \mathrm{d} s+\frac{\sigma^{2}}{4 \kappa} B^{2}(t, T) \\
&amp;+\frac{\sigma^{2}}{2 \kappa^{2}}(B(t, T)-(T-t))
\end{aligned}
\]</span>
Using partial integration we have that
<span class="math display">\[
\int_{t}^{T} \frac{\mathrm{d} \bar{f}(0, s)}{\mathrm{d} t} \mathrm{e}^{-\kappa(T-s)} \mathrm{d} s=\bar{f}(0, T)-\bar{f}(0, t) \mathrm{e}^{-\kappa(T-t)}-\kappa \int_{t}^{T} \bar{f}(0, s) \mathrm{e}^{-\kappa(T-s)} \mathrm{d} s .
\]</span>
Inserting this in the expression for <span class="math inline">\(A(t, T)\)</span> yields
<span class="math display">\[
\begin{aligned}
A(t, T) &amp;=-\ln \left(\frac{\bar{P}_{0}^{T}}{P_{0}^{t}}\right)-B(t, T) \bar{f}(0, t)+\int_{t}^{T} \frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa s}\right) B(s, T) \mathrm{d} s+\frac{\sigma^{2}}{4 \kappa} B^{2}(t, T) \\
&amp;+\frac{\sigma^{2}}{2 \kappa^{2}}(B(t, T)-(T-t))
\end{aligned}
\]</span>
We will now evaluate the last integral:
<span class="math display">\[
\begin{aligned}
\int_{t}^{T} \frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa s}\right) B(s, T) \mathrm{d} s &amp;=\frac{\sigma^{2}}{2 \kappa^{2}} \int_{t}^{T}\left(1-\mathrm{e}^{-2 \kappa s}\right)\left(1-\mathrm{e}^{-\kappa(T-s)}\right) \mathrm{d} s \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}} \int_{t}^{T} 1-\mathrm{e}^{-\kappa(T-s)}-\mathrm{e}^{-2 \kappa s}+\mathrm{e}^{-\kappa(T+s)} \mathrm{d} s \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}}\left[(T-t)-\frac{1}{\kappa}+\frac{1}{\kappa} \mathrm{e}^{-\kappa(T-t)}+\frac{1}{2 \kappa} \mathrm{e}^{-2 \kappa T}-\frac{1}{2 \kappa} \mathrm{e}^{-2 \kappa t}\right.\\
&amp;\left.-\frac{1}{\kappa} \mathrm{e}^{-2 \kappa T}+\frac{1}{\kappa} \mathrm{e}^{-\kappa(T+t)}\right] \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}}\left[(T-t)-B(t, T)-\frac{1}{2 \kappa} \mathrm{e}^{-2 \kappa T}-\frac{1}{2 \kappa} \mathrm{e}^{-2 \kappa t}+\frac{1}{\kappa} \mathrm{e}^{-\kappa(T+t)}\right] \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}}\left[(T-t)-B(t, T)-\frac{\kappa}{2} \mathrm{e}^{-2 \kappa t} B^{2}(t, T)\right]
\end{aligned}
\]</span>
Now we can insert into <span class="math inline">\(A(t, T)\)</span> and the result follows:
<span class="math display">\[
A(t, T)=-\ln \left(\frac{\bar{P}_{0}^{T}}{\bar{P}_{0}^{t}}\right)-B(t, T) \bar{f}(0, t)+\frac{\sigma^{2}}{4 \kappa} B^{2}(t, T)\left(1-\mathrm{e}^{-2 \kappa t}\right)
\]</span></p>
</div>
<div id="the-variance-of-the-short-rate" class="section level2" number="9.3">
<h2><span class="header-section-number">A.3</span> The Variance of the Short Rate</h2>
<p>We will determine the distribution of the short rate in the extended Vasicek model under the <span class="math inline">\(\mathbb{Q}^{T}\)</span> measure. To do so we apply Itoâs lemma to the quantity <span class="math inline">\(\mathrm{e}^{a t} r_{\mathrm{t}}\)</span> :
<span class="math display">\[
\begin{aligned}
\mathrm{d}\left(\mathrm{e}^{a t} r_{t}\right) &amp;=a \mathrm{e}^{a t} r_{t} \mathrm{~d} t+\mathrm{e}^{a t} \mathrm{~d} r_{t} \\
&amp;=a \mathrm{e}^{a t} r_{t} \mathrm{~d} t+\mathrm{e}^{a t}\left[\kappa\left(\hat{\theta}(t)-r_{t}\right)-\sigma^{2} B(t, T)\right] \mathrm{d} t+\mathrm{e}^{a t} \sigma \mathrm{d} W_{t}^{\mathrm{Q}^{T}}
\end{aligned}
\]</span>
Choosing <span class="math inline">\(a=\kappa\)</span> and integrating from <span class="math inline">\(t\)</span> to <span class="math inline">\(T\)</span> and we obtain
<span class="math display">\[
\mathrm{e}^{\kappa T} r_{T}-\mathrm{e}^{\kappa t} r_{t}=\int_{t}^{T} \kappa \mathrm{e}^{\kappa s} \hat{\theta}(s)-\mathrm{e}^{\kappa s} \sigma^{2} B(s, T) \mathrm{d} s+\sigma \int_{t}^{T} \mathrm{e}^{a s} \mathrm{~d} W_{s}^{\mathrm{Q}^{T}}
\]</span>
Moving <span class="math inline">\(\mathrm{e}^{\kappa t}\)</span> to the right hand side and dividing by <span class="math inline">\(\mathrm{e}^{\kappa T}\)</span> we obtain
<span class="math display">\[
r_{T}=\mathrm{e}^{-\kappa(T-t)} r_{t}+\mathrm{e}^{-\kappa T} \int_{t}^{T} \kappa \mathrm{e}^{\kappa s} \hat{\theta}(s)-\mathrm{e}^{\kappa s} \sigma^{2} B(s, T) \mathrm{d} s+\sigma \mathrm{e}^{-\kappa T} \int_{t}^{T} \mathrm{e}^{\kappa s} \mathrm{~d} W_{s}^{\mathrm{Q}^{T}}
\]</span>
Since <span class="math inline">\(e^{\kappa t}\)</span> is just a deterministic function, the stochastic integral will be normally distributed. The variance of <span class="math inline">\(r_{T}\)</span> will therefore be given by
<span class="math display">\[
\begin{aligned}
\mathbb{V}_{t}^{\mathbb{Q}^{T}}\left[r_{T}\right] &amp;=\mathbb{V}_{t}^{\mathbb{Q}^{T}}\left[\sigma \mathrm{e}^{-\kappa T} \int_{t}^{T} \mathrm{e}^{\kappa s} \mathrm{~d} W_{s}^{\mathbb{Q}^{T}}\right] \\
&amp;=\sigma^{2} \mathrm{e}^{-2 \kappa T} \int_{t}^{T} \mathrm{e}^{2 \kappa s} \mathrm{~d} s \\
&amp;=\frac{\sigma^{2}}{2 \kappa} \mathrm{e}^{-2 \kappa T}\left(\mathrm{e}^{2 \kappa T}-\mathrm{e}^{2 \kappa t}\right) \\
&amp;=\frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \kappa(T-t)}\right)
\end{aligned}
\]</span></p>
</div>
<div id="the-expected-value-under-mathbbqs" class="section level2" number="9.4">
<h2><span class="header-section-number">A.4</span> The Expected Value Under <span class="math inline">\(\mathbb{Q}\)</span>^S</h2>
<p>We would like to evaluate the expectation <span class="math inline">\(\mathbb{E}^{Q^{S}}\left[P_{T}^{S}\right]\)</span>. We know that any price process deflated by <span class="math inline">\(P_{t}^{S}\)</span> is a martingale under <span class="math inline">\(\mathbb{Q}^{S}\)</span> and in particular by equation (2.35) we have that
<span class="math display">\[
\mathrm{d} \frac{P_{t}^{T}}{P_{t}^{S}}=\left(\beta^{T}\left(t, r_{t}\right)-\beta^{S}\left(t, r_{t}\right)\right) \frac{P_{t}^{T}}{P_{t}^{S}} \mathrm{~d} W_{t}^{Q^{S}}
\]</span>
Since we are in the extended Vasicek model we have <span class="math inline">\(\beta^{T}\left(t, r_{t}\right)=-\sigma B(t, T)\)</span> and <span class="math inline">\(\beta^{S}\left(t, r_{t}\right)=\)</span> <span class="math inline">\(-\sigma B(t, S)\)</span>. Inserting these we get
<span class="math display">\[
\mathrm{d} \frac{P_{t}^{T}}{P_{t}^{S}}=\sigma(B(t, S)-B(t, T)) \frac{P_{t}^{T}}{P_{t}^{S}} \mathrm{~d} W_{t}^{Q^{S}}
\]</span>
Since <span class="math inline">\(P_{T}^{T}=1\)</span> we must have <span class="math inline">\(\mathbb{E}^{Q^{S}}\left[P_{T}^{S}\right]=\mathbb{E}^{Q^{S}}\left[\frac{P_{T}^{S}}{P_{T}^{T}}\right]\)</span>. To evaluate this expectation we will need the distribution of <span class="math inline">\(\frac{p_{t}^{S}}{p_{t}^{X}}\)</span>. By Itoâs lemma and equation (A.8) we have that
<span class="math display">\[
\mathrm{d} \frac{P_{t}^{S}}{P_{t}^{T}}=\sigma^{2}(B(t, S)-B(t, T))^{2} \frac{P_{t}^{S}}{P_{t}^{T}} \mathrm{~d} t-\sigma(B(t, S)-B(t, T)) \frac{P_{t}^{S}}{P_{t}^{T}} \mathrm{~d} W_{t}^{Q^{S}}
\]</span>
Taking the logarithm of <span class="math inline">\(\frac{P_{t}^{S}}{P_{t}^{T}}\)</span> and using again Itoâs lemma we get
<span class="math display">\[
\mathrm{d} \ln \frac{P_{t}^{S}}{P_{t}^{T}}=\frac{1}{2} \sigma^{2}(B(t, S)-B(t, T))^{2} \mathrm{~d} t-\sigma(B(t, S)-B(t, T)) \mathrm{d} W_{t}^{\mathrm{Q}^{S}}
\]</span>
Integrating from <span class="math inline">\(t\)</span> to <span class="math inline">\(T\)</span> and rearranging yields
<span class="math display">\[
\frac{P_{T}^{S}}{P_{T}^{T}}=\frac{P_{t}^{S}}{P_{t}^{T}} \mathrm{e} J_{t}^{T} \frac{1}{2} \sigma^{2}(B(u, S)-B(u, T))^{2} \mathrm{~d} u-\sigma \int_{t}^{T}(B(u, S)-B(u, T)) \mathrm{d} W_{u}^{0^{S}}
\]</span>
The inside of the exponential function will be Gaussian, so we will determine the mean <span class="math inline">\(\hat{\mu}\)</span> and variance <span class="math inline">\(\hat{\sigma}^{2}\)</span>. The mean can be found as
<span class="math display">\[
\begin{aligned}
\hat{\mu} &amp;=\int_{t}^{T} \frac{1}{2} \sigma^{2}(B(u, S)-B(u, T))^{2} \mathrm{~d} u \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}} \int_{t}^{T}\left(\mathrm{e}^{-\kappa(T-u)}-\mathrm{e}^{-\kappa(S-u)}\right)^{2} \mathrm{~d} u \\
&amp;=\frac{\sigma^{2}}{2 \kappa^{2}}\left(\mathrm{e}^{-\kappa T}-\mathrm{e}^{-\kappa S}\right)^{2} \int_{t}^{T} \mathrm{e}^{2 \kappa u} \mathrm{~d} u \\
&amp;=\frac{\sigma^{2}}{4 \kappa^{3}}\left(\mathrm{e}^{-\kappa T}-\mathrm{e}^{-\kappa S}\right)^{2}\left(\mathrm{e}^{2 \kappa T}-\mathrm{e}^{2 \kappa t}\right) \\
&amp;=\frac{\sigma^{2}}{4 \kappa^{3}} \mathrm{e}^{-2 \kappa T}\left(1-\mathrm{e}^{-\kappa(S-T)}\right)^{2}\left(\mathrm{e}^{2 \kappa T}-\mathrm{e}^{2 \kappa t}\right) \\
&amp;=\frac{\sigma^{2}}{4 \kappa^{3}}\left(1-\mathrm{e}^{-\kappa(S-T)}\right)^{2}\left(1-\mathrm{e}^{-2 \kappa(T-t)}\right) \\
&amp;=\frac{1}{2} B^{2}(T, S) \nu^{2}(t, T)
\end{aligned}
\]</span>
The variance can be found as
<span class="math display">\[
\begin{aligned}
\hat{\sigma}^{2} &amp;=\mathbb{V}_{t}^{\mathrm{Q}^{S}}\left(-\sigma \int_{t}^{T} B(u, S)-B(u, T) \mathrm{d} W_{u}^{Q^{S}}\right) \\
&amp;=\sigma^{2} \int_{t}^{T}(B(u, S)-B(u, T))^{2} \mathrm{~d} u \\
&amp;=2 \hat{\mu} .
\end{aligned}
\]</span></p>
<p>Let <span class="math inline">\(X \sim \mathcal{N}\left(\hat{\mu}, \hat{\sigma}^{2}\right)\)</span>, then we can now evaluate the desired expectation:
<span class="math display">\[
\begin{aligned}
\mathbb{E}_{t}^{Q^{S}}\left[\frac{P_{T}^{S}}{P_{T}^{T}}\right] &amp;=\frac{P_{t}^{S}}{P_{t}^{T}} \mathbb{E}\left[\mathrm{e}^{X}\right] \\
&amp;=\frac{P_{t}^{S}}{P_{t}^{T}} \mathrm{e}^{\tilde{\mu}+\frac{1}{2} \dot{\sigma}^{2}} \\
&amp;=\frac{P_{t}^{S}}{P_{t}^{T}} \mathrm{e}^{B^{2}(T, S) \nu^{2}(t, T)}
\end{aligned}
\]</span></p>
</div>
<div id="vasicek-mle" class="section level2" number="9.5">
<h2><span class="header-section-number">A.5</span> Vasicek MLE</h2>
<p>By similar calculations as in A.3 and using that <span class="math inline">\(\theta(t)=\theta\)</span> is a constant, we can find
<span class="math display">\[
r_{T}=\mathrm{e}^{-\kappa(T-t)} r_{t}+\theta\left[1-\mathrm{e}^{-\kappa(T-t)}\right]+\sigma \mathrm{e}^{-\kappa T} \int_{t}^{T} \mathrm{e}^{\kappa s} \mathrm{~d} W_{s}^{\mathbb{P}}
\]</span>
The conditional mean is given by
<span class="math display">\[
\mathbb{E}_{t}\left[r_{T}\right]=\mathrm{e}^{-\kappa(T-t)} r_{t}+\theta\left[1-\mathrm{e}^{-\kappa(T-t)}\right]
\]</span>
and appendix A.3 derived the variance as
<span class="math display">\[
\mathbb{V}_{t}\left[r_{T}\right]=\frac{\sigma^{2}}{2 \kappa}\left(1-\mathrm{e}^{-2 \mathrm{k}(T-t)}\right)
\]</span>
Since the stochastic integral is Gaussian, we will have that the increments are also Gaussian, and the conditional density will therefore be
<span class="math display">\[
f_{r_{i_{i}}}\left(x \mid r_{t_{i-1}}, \kappa, \theta, \sigma\right)=\frac{1}{\sqrt{2 \pi \nu_{i}}} \mathrm{e}^{-\frac{\left(x-\mu_{i}\right)^{2}}{2 \nu_{i}}},
\]</span>
where
<span class="math display">\[
\mu_{i}=\mathrm{e}^{-\kappa \Delta t_{i} r_{t_{i-1}}}+\theta\left[1-\mathrm{e}^{-\kappa \Delta t_{i}}\right], \quad \nu_{i}=\frac{\sigma^{2}}{2 \kappa_{i}}\left(1-\mathrm{e}^{-2 \kappa \Delta t_{i}}\right) \quad \text { and } \quad \Delta t_{i}=t_{i}-t_{i-1}
\]</span>
The log likelihood is therefore given by
<span class="math display">\[
\log \mathcal{L}\left(\kappa, \theta, \sigma \mid\left\{r_{t_{i}}\right\}_{i=0}^{N}\right)=-\frac{N}{2} \ln (2 \pi)-\sum_{i=1}^{N} \ln v_{i}+\frac{\left(r_{t_{i}}-\mu_{i}\right)^{2}}{2 \nu_{i}^{2}}
\]</span>
Performing an estimation in Matlab for the period 1996 to 2017 with the <span class="math inline">\(1 \mathrm{Y}\)</span> swap rate as a proxy for the dynamics of the short rate and we get the results in table 6 .</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="conclusion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="roadmap.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
